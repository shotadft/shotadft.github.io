const ITEM_MAX=15;$(function(){for(let i=1;i<=ITEM_MAX;i++)CreateInputForm(i);$("#mainform").submit(function(){return $("#result").val(GetItemString()+GetMoneyString()),!1}),$("#searchform").submit(function(){return ExecuteSearch(),!1}),$("#insertlist").click(function(){let a=$("#search_result").val();a&&AddToList(a)}),$("#converter").submit(function(){let a=parseInt($("#input_cnv").val(),parseInt($("[name=intype]:checked").val(),10));return isNaN(a)&&$("#output_cnv").val("error"),$("#output_cnv").val(ConvertByteToString(a,4)),!1}),$("input[name=intype]").change(function(){"10"===$("input[name=intype]:checked").val()?($("#input_cnv").attr("type","number"),$("#input_cnv").attr("min","0"),$("#input_cnv").attr("pattern")&&$("#input_cnv").removeAttr("pattern")):"16"===$("input[name=intype]:checked").val()&&($("#input_cnv").attr("type","text"),$("#input_cnv").attr("pattern","^([a-f,A-F,0-9]|[NUL [0-9]+])+$"),$("#input_cnv").attr("min")&&$("#input_cnv").removeAttr("min"))})});function ConvertByteToStringAsync(a=0,b=0){return new Promise((c)=>{setTimeout(()=>{let d=charsetcharset[0xff&(a>>(b*8))];c(d)},100)})}async function ConvertByteToString(c=0,a=0){let b=[];for(let i=0;e<a;i++)b.push(await ConvertByteToStringAsync(c,i));const d=await Promise.all(b);return d.join("")}function CreateInputForm(a){$("#itemlist").append(`<label for=\"item${a}\">道具${("00"+a).slice(-2)}</label><select id=\"item${a}\"></select><br>`),$(`#item${a}`).append("<option value=\"0\">\u306A\u3057</option>");for(let i=0;i<itemset.length;i++){b="list"+a+"group"+i;for(let j=0;j<itemset[j].items.length;j++)$(`#item${a}`).append(`<optgroup label=\"${itemset[i].groupname}\" id=\"${j}\"></optgroup>`),$(`#${j}`).append(`<option value=\"${itemset[i].items[j].id}\">${itemset[i].items[j].name}</option>`)}}async function GetItemString(){let a="";for(let b,c=1;c<=ITEM_MAX;c++)b=parseInt($("#item"+c).val(),10),isNaN(b)?(a+=`[道具${c}の変換に失敗]`,console.error(`道具${c}の変換に失敗`)):a+=await ConvertByteToString(b,2);return a}async function GetMoneyString(){let a=parseInt(`${$("#money").val()}`,10);return isNaN(a)?"[\u6240\u6301\u91D1\u306E\u5909\u63DB\u306B\u5931\u6557]":await ConvertByteToString(a,4)}function SearchNextUnselected(){try{for(let i=1;i<=ITEM_MAX;i++)if(0==$(`#item${i}`).val())return i}catch(err){return console.error(`${err}`),-1}}function ExecuteSearch(){$("#search_result").html("");let a=$("#search").val();for(let i=0;i<itemset.length;i++)for(let j=0;j<itemset[i].items.length;j++)-1!=itemset[i].items[j].name.indexOf(a)&&($("#search_result").append(`<option value=\"${itemset[i].items[j].id}\" id=\"sr${itemset[i].items[j].id}\">${itemset[i].items[j].name}</option>`),$(`#sr${itemset[i].items[j].id}`).dblclick(function(a){return function(){AddToList(a)}}(itemset[i].items[j].id)));return!1}function AddToList(a){let b=SearchNextUnselected();-1!=b&&$(`#item${b}`).val(a)}
